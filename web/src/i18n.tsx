import React, { useEffect, useMemo, useState } from 'react'
import { I18nContext, type I18nContextType, type Language } from './i18nContext'

const translations: Record<Language, Record<string, string>> = {
  en: {
    'app.title': 'Dog Walk Logger',
    'header.language': 'Language',
    'header.toggle_en': 'English',
    'header.toggle_pt': 'Portuguese (BR)',

    'form.title': 'Register Walk',
    'form.title_edit': 'Edit Walk',
    'form.dogName': 'Dog name',
    'form.walkDatetime': 'Walk date and time',
    'form.duration': 'Duration (minutes)',
    'form.distance': 'Distance (km)',
    'form.route': 'Route/Location',
    'form.weather': 'Weather',
    'form.weather.sunny': 'Sunny',
    'form.weather.cloudy': 'Cloudy',
    'form.weather.rainy': 'Rainy',
    'form.weather.windy': 'Windy',
    'form.energy': 'Energy level',
    'form.energy.help': 'Tap 1‚Äì5 stars',
    'form.notes': 'Notes/observations',
    'form.photo': 'Photo (optional)',
    'form.submit': 'Save walk',
    'form.update': 'Update walk',
    'form.cancel': 'Cancel',
    'form.required': 'Required',
    'form.validation.duration_positive': 'Duration must be greater than zero',
    'form.validation.distance_nonnegative': 'Distance cannot be negative',
    'form.validation.energy_required': 'Select an energy level',
    'form.success': 'Walk saved!',
    'form.updated': 'Walk updated!',
    'form.error.upload_failed': 'Could not load photo',

    'tabs.register': 'Register Walk',
    'tabs.history': 'History',
    'tabs.stats': 'Statistics',
    'tabs.about': 'About',

    // Stats
    'stats.title': 'Statistics & Insights',
    'stats.filter.period': 'Period',
    'stats.period.this_week': 'This week',
    'stats.period.this_month': 'This month',
    'stats.period.last_3_months': 'Last 3 months',
    'stats.period.all_time': 'All time',

    'stats.metrics.total_walks': 'Total walks',
    'stats.metrics.total_distance': 'Total distance',
    'stats.metrics.total_time': 'Total time',
    'stats.metrics.avg_duration': 'Average duration',
    'stats.metrics.longest_walk': 'Longest walk',
    'stats.metrics.longest_walk.distance': 'Distance',
    'stats.metrics.most_active_dog': 'Most active dog',
    'stats.metrics.this_week': 'This week',
    'stats.metrics.this_month': 'This month',
    'stats.metrics.all_time': 'All time',

    'stats.streak.title': 'Streak',
    'stats.streak.current': 'Current streak',
    'stats.streak.best': 'Best streak',
    'stats.streak.message.active': "You're on a {days}-day streak! Keep it up! üî•",
    'stats.streak.message.zero': 'Start your streak today! üêæ',

    'stats.graphs.walks_by_weekday.title': 'Walks by Weekday',
    'stats.graphs.distance_by_week.title': 'Distance by Week (last 4)',
    'stats.graphs.time_by_week.title': 'Time by Week (last 4)',
    'stats.graphs.weather_distribution.title': 'Weather distribution',
    'stats.weekday.mon': 'Mon',
    'stats.weekday.tue': 'Tue',
    'stats.weekday.wed': 'Wed',
    'stats.weekday.thu': 'Thu',
    'stats.weekday.fri': 'Fri',
    'stats.weekday.sat': 'Sat',
    'stats.weekday.sun': 'Sun',

    'stats.ranking.title': 'Top 5 Most Active Days',
    'stats.ranking.headers.date': 'Date',
    'stats.ranking.headers.count': 'Walks',
    'stats.ranking.headers.distance': 'Distance',

    'stats.empty.title': 'Log more walks to see your stats! üìä',
    'stats.empty.cta': 'Log your first walk',

    'stats.achievements.title': 'Achievements',
    'stats.achievements.bronze': 'Bronze: 10 walks',
    'stats.achievements.silver': 'Silver: 50 walks',
    'stats.achievements.gold': 'Gold: 100 walks',
    'stats.achievements.platinum': 'Platinum: 365 walks',
    'stats.achievements.progress_to_next': 'Progress to next',

    'history.title': 'Walk History',
    'history.sort_by': 'Sort by',
    'history.sort.date_desc': 'Date (newest)',
    'history.sort.date_asc': 'Date (oldest)',
    'history.sort.duration': 'Duration',
    'history.sort.distance': 'Distance',
    'history.filter.dog': 'Dog',
    'history.filter.any': 'Any',
    'history.search': 'Search',
    'history.search.placeholder': 'Dog name or notes‚Ä¶',
    'history.filter.start': 'Start date',
    'history.filter.end': 'End date',
    'history.filter.weather': 'Weather',
    'history.clear_filters': 'Clear filters',
    'history.total': '{count} walks found',
    'history.empty': 'No walks yet. How about a walk? üêæ',
    'history.go_register': 'Go to register form',
    'history.edit': 'Edit',
    'history.delete': 'Delete',
    'history.confirm_delete': 'Delete this walk?',
    'history.deleted': 'Walk deleted',
    'history.error_delete': 'Could not delete walk',
    'history.prev': 'Previous',
    'history.next': 'Next',
    'history.page_of': 'Page {page} of {total}',
    // About
    'about.title': 'About',
    'about.description': 'Dog Walk Logger helps you track your dogs‚Äô walks, visualize stats, and build healthy habits.',
    'about.how.title': 'How to use',
    'about.how.register': 'Register: fill the form and save the walk.',
    'about.how.history': 'History: filter, search, edit or delete entries.',
    'about.how.stats': 'Statistics: explore insights, charts, and streaks.',
    'about.tips.title': 'Tips to keep streaks',
    'about.tips.daily': 'Log daily walks to build momentum.',
    'about.tips.reminders': 'Set personal reminders to avoid gaps.',
    'about.tips.notes': 'Add notes to remember context and patterns.',
    'about.credits.title': 'Credits',
    'about.credits.text': 'Built with TRAE.ai üêæ',
    // Toasts
    'toast.saved': 'Walk saved successfully! ‚úÖ',
    'toast.updated': 'Walk updated! ‚úèÔ∏è',
    'toast.deleted': 'Walk deleted! üóëÔ∏è',
    // Confirm leave
    'form.confirm_leave': 'You have unsaved changes. Leave the form?',
    // Auth / Welcome
    'auth.welcome.slogan': 'Track every adventure with your best friend! üêæ',
    'auth.welcome.create_account': 'Create Account',
    'auth.welcome.login': 'I already have an account ‚Äì Sign in',
    'auth.login.title': 'Sign In',
    'auth.login.email': 'Email',
    'auth.login.password': 'Password',
    'auth.login.remember': 'Remember me',
    'auth.login.submit': 'Sign in',
    'auth.login.forgot': 'Forgot your password?',
    'auth.login.no_account': "Don't have an account? Register",
    'auth.login.error_invalid': 'Invalid credentials',
    'auth.register.title': 'Create your account',
    'auth.register.user.name': 'Full name',
    'auth.register.user.email': 'Email',
    'auth.register.user.password': 'Password',
    'auth.register.user.confirm': 'Confirm password',
    'auth.register.user.photo': 'Profile photo (optional)',
    'auth.register.dog.name': 'Dog name',
    'auth.register.dog.breed': 'Breed',
    'auth.register.dog.weight': 'Weight (kg)',
    'auth.register.dog.birthdate': 'Birth date',
    'auth.register.dog.sex': 'Sex',
    'auth.register.dog.sex.male': 'Male',
    'auth.register.dog.sex.female': 'Female',
    'auth.register.dog.photo': 'Dog photo (optional)',
    'auth.register.dog.color': 'Coat color',
    'auth.register.dog.notes': 'Special notes',
    'auth.register.submit': 'Create account and start',
    'auth.register.error.email_exists': 'Email already registered',
    'auth.register.error.password_weak': 'Password must be at least 6 characters',
    'auth.register.error.password_mismatch': 'Passwords must match',
    // Tabs additions
    'tabs.dogs': 'My Dogs',
    'tabs.profile': 'Profile',
    // Dogs manager
    'dogs.title': 'My Dogs',
    'dogs.add_new': 'Add New Dog',
    'dogs.favorite': 'Favorite',
    'dogs.edit': 'Edit profile',
    'dogs.remove': 'Remove',
    'dogs.confirm_remove': 'Remove this dog?',
    'dogs.empty': 'No dogs yet. Add your first dog!',
    // Profile
    'profile.menu.profile': 'View profile',
    'profile.menu.settings': 'Settings',
    'profile.menu.logout': 'Sign out',
    'profile.title': 'Tutor Profile',
    'profile.since': 'Using the app since {date}',
    'profile.stats.total_walks': 'Total walks',
    // Form dog selection
    'form.dog.select': 'Select dog',
  },
  'pt-BR': {
    'app.title': 'Dog Walk Logger',
    'header.language': 'Idioma',
    'header.toggle_en': 'Ingl√™s',
    'header.toggle_pt': 'Portugu√™s (BR)',

    'form.title': 'Registrar Passeio',
    'form.title_edit': 'Editar Passeio',
    'form.dogName': 'Nome do cachorro',
    'form.walkDatetime': 'Data e hora do passeio',
    'form.duration': 'Dura√ß√£o (minutos)',
    'form.distance': 'Dist√¢ncia (km)',
    'form.route': 'Rota/Local',
    'form.weather': 'Clima',
    'form.weather.sunny': 'Ensolarado',
    'form.weather.cloudy': 'Nublado',
    'form.weather.rainy': 'Chuvoso',
    'form.weather.windy': 'Ventando',
    'form.energy': 'N√≠vel de energia',
    'form.energy.help': 'Toque 1‚Äì5 estrelas',
    'form.notes': 'Notas/observa√ß√µes',
    'form.photo': 'Foto (opcional)',
    'form.submit': 'Salvar passeio',
    'form.update': 'Atualizar passeio',
    'form.cancel': 'Cancelar',
    'form.required': 'Obrigat√≥rio',
    'form.validation.duration_positive': 'A dura√ß√£o deve ser maior que zero',
    'form.validation.distance_nonnegative': 'A dist√¢ncia n√£o pode ser negativa',
    'form.validation.energy_required': 'Selecione um n√≠vel de energia',
    'form.success': 'Passeio salvo!',
    'form.updated': 'Passeio atualizado!',
    'form.error.upload_failed': 'N√£o foi poss√≠vel carregar a foto',

    'tabs.register': 'Registrar Passeio',
    'tabs.history': 'Hist√≥rico',
    'tabs.stats': 'Estat√≠sticas',
    'tabs.about': 'Sobre',

    // Stats
    'stats.title': 'Estat√≠sticas e Insights',
    'stats.filter.period': 'Per√≠odo',
    'stats.period.this_week': 'Esta semana',
    'stats.period.this_month': 'Este m√™s',
    'stats.period.last_3_months': '√öltimos 3 meses',
    'stats.period.all_time': 'Todos os tempos',

    'stats.metrics.total_walks': 'Total de passeios',
    'stats.metrics.total_distance': 'Dist√¢ncia total',
    'stats.metrics.total_time': 'Tempo total',
    'stats.metrics.avg_duration': 'Dura√ß√£o m√©dia',
    'stats.metrics.longest_walk': 'Passeio mais longo',
    'stats.metrics.longest_walk.distance': 'Dist√¢ncia',
    'stats.metrics.most_active_dog': 'Cachorro mais ativo',
    'stats.metrics.this_week': 'Esta semana',
    'stats.metrics.this_month': 'Este m√™s',
    'stats.metrics.all_time': 'Todos os tempos',

    'stats.streak.title': 'Sequ√™ncia',
    'stats.streak.current': 'Sequ√™ncia atual',
    'stats.streak.best': 'Melhor sequ√™ncia',
    'stats.streak.message.active': 'Voc√™ est√° em uma sequ√™ncia de {days} dias! Continue assim! üî•',
    'stats.streak.message.zero': 'Comece sua sequ√™ncia hoje! üêæ',

    'stats.graphs.walks_by_weekday.title': 'Passeios por Dia da Semana',
    'stats.graphs.distance_by_week.title': 'Dist√¢ncia por Semana (√∫ltimas 4)',
    'stats.graphs.time_by_week.title': 'Tempo por Semana (√∫ltimas 4)',
    'stats.graphs.weather_distribution.title': 'Distribui√ß√£o por Clima',
    'stats.weekday.mon': 'Seg',
    'stats.weekday.tue': 'Ter',
    'stats.weekday.wed': 'Qua',
    'stats.weekday.thu': 'Qui',
    'stats.weekday.fri': 'Sex',
    'stats.weekday.sat': 'S√°b',
    'stats.weekday.sun': 'Dom',

    'stats.ranking.title': 'Top 5 Dias Mais Ativos',
    'stats.ranking.headers.date': 'Data',
    'stats.ranking.headers.count': 'Passeios',
    'stats.ranking.headers.distance': 'Dist√¢ncia',

    'stats.empty.title': 'Registre mais passeios para ver suas estat√≠sticas! üìä',
    'stats.empty.cta': 'Registrar primeiro passeio',

    'stats.achievements.title': 'Conquistas',
    'stats.achievements.bronze': 'Bronze: 10 passeios',
    'stats.achievements.silver': 'Prata: 50 passeios',
    'stats.achievements.gold': 'Ouro: 100 passeios',
    'stats.achievements.platinum': 'Platina: 365 passeios',
    'stats.achievements.progress_to_next': 'Progresso at√© a pr√≥xima',

    'history.title': 'Hist√≥rico de Passeios',
    'history.sort_by': 'Ordenar por',
    'history.sort.date_desc': 'Data (mais recente)',
    'history.sort.date_asc': 'Data (mais antiga)',
    'history.sort.duration': 'Dura√ß√£o',
    'history.sort.distance': 'Dist√¢ncia',
    'history.filter.dog': 'Nome do cachorro',
    'history.filter.any': 'Qualquer',
    'history.search': 'Busca',
    'history.search.placeholder': 'Nome do cachorro ou notas‚Ä¶',
    'history.filter.start': 'Data inicial',
    'history.filter.end': 'Data final',
    'history.filter.weather': 'Clima',
    'history.clear_filters': 'Limpar filtros',
    'history.total': '{count} passeios encontrados',
    'history.empty': 'Nenhum passeio registrado ainda. Que tal levar seu amigo para passear? üêæ',
    'history.go_register': 'Ir ao formul√°rio de registro',
    'history.edit': 'Editar',
    'history.delete': 'Excluir',
    'history.confirm_delete': 'Excluir este passeio?',
    'history.deleted': 'Passeio exclu√≠do',
    'history.error_delete': 'N√£o foi poss√≠vel excluir o passeio',
    'history.prev': 'Anterior',
    'history.next': 'Pr√≥xima',
    'history.page_of': 'P√°gina {page} de {total}',
    // About
    'about.title': 'Sobre',
    'about.description': 'O Dog Walk Logger ajuda voc√™ a registrar os passeios dos seus c√£es, visualizar estat√≠sticas e manter h√°bitos saud√°veis.',
    'about.how.title': 'Como usar',
    'about.how.register': 'Registro: preencha o formul√°rio e salve o passeio.',
    'about.how.history': 'Hist√≥rico: filtre, pesquise, edite ou exclua passeios.',
    'about.how.stats': 'Estat√≠sticas: explore insights, gr√°ficos e streaks.',
    'about.tips.title': 'Dicas para manter streaks',
    'about.tips.daily': 'Registre passeios diariamente para criar const√¢ncia.',
    'about.tips.reminders': 'Crie lembretes pessoais para evitar lacunas.',
    'about.tips.notes': 'Adicione notas para lembrar contextos e padr√µes.',
    'about.credits.title': 'Cr√©ditos',
    'about.credits.text': 'Built with TRAE.ai üêæ',
    // Toasts
    'toast.saved': 'Passeio salvo com sucesso! ‚úÖ',
    'toast.updated': 'Passeio atualizado! ‚úèÔ∏è',
    'toast.deleted': 'Passeio exclu√≠do! üóëÔ∏è',
    // Confirm leave
    'form.confirm_leave': 'Voc√™ tem altera√ß√µes n√£o salvas. Deseja sair do formul√°rio?',
    // Auth / Welcome
    'auth.welcome.slogan': 'Acompanhe cada aventura com seu melhor amigo! üêæ',
    'auth.welcome.create_account': 'Criar Conta',
    'auth.welcome.login': 'J√° tenho conta ‚Äì Entrar',
    'auth.login.title': 'Entrar',
    'auth.login.email': 'Email',
    'auth.login.password': 'Senha',
    'auth.login.remember': 'Lembrar-me',
    'auth.login.submit': 'Entrar',
    'auth.login.forgot': 'Esqueceu a senha?',
    'auth.login.no_account': 'N√£o tem conta? Cadastre-se',
    'auth.login.error_invalid': 'Credenciais inv√°lidas',
    'auth.register.title': 'Crie sua conta',
    'auth.register.user.name': 'Nome completo',
    'auth.register.user.email': 'Email',
    'auth.register.user.password': 'Senha',
    'auth.register.user.confirm': 'Confirmar senha',
    'auth.register.user.photo': 'Foto de perfil (opcional)',
    'auth.register.dog.name': 'Nome do cachorro',
    'auth.register.dog.breed': 'Ra√ßa',
    'auth.register.dog.weight': 'Peso (kg)',
    'auth.register.dog.birthdate': 'Data de nascimento',
    'auth.register.dog.sex': 'Sexo',
    'auth.register.dog.sex.male': 'Macho',
    'auth.register.dog.sex.female': 'F√™mea',
    'auth.register.dog.photo': 'Foto do cachorro (opcional)',
    'auth.register.dog.color': 'Cor da pelagem',
    'auth.register.dog.notes': 'Observa√ß√µes especiais',
    'auth.register.submit': 'Criar conta e come√ßar',
    'auth.register.error.email_exists': 'Email j√° cadastrado',
    'auth.register.error.password_weak': 'Senha deve ter pelo menos 6 caracteres',
    'auth.register.error.password_mismatch': 'As senhas devem coincidir',
    // Tabs additions
    'tabs.dogs': 'Meus Cachorros',
    'tabs.profile': 'Perfil',
    // Dogs manager
    'dogs.title': 'Meus Cachorros',
    'dogs.add_new': 'Adicionar Novo Cachorro',
    'dogs.favorite': 'Favorito',
    'dogs.edit': 'Editar perfil',
    'dogs.remove': 'Remover',
    'dogs.confirm_remove': 'Remover este cachorro?',
    'dogs.empty': 'Nenhum cachorro cadastrado. Adicione seu primeiro!',
    // Profile
    'profile.menu.profile': 'Ver perfil',
    'profile.menu.settings': 'Configura√ß√µes',
    'profile.menu.logout': 'Sair',
    'profile.title': 'Perfil do Tutor',
    'profile.since': 'Usa o app desde {date}',
    'profile.stats.total_walks': 'Total de passeios',
    // Form dog selection
    'form.dog.select': 'Selecione o cachorro',
  },
}

export function LanguageProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLang] = useState<Language>(() => {
    const saved = localStorage.getItem('lang') as Language | null
    return saved || 'en'
  })

  useEffect(() => {
    localStorage.setItem('lang', lang)
  }, [lang])

  const t = useMemo(() => {
    return (key: string) => translations[lang]?.[key] ?? key
  }, [lang])

  const value = useMemo<I18nContextType>(() => ({ lang, setLang, t }), [lang, t])

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>
}

// Hook useI18n foi movido para './useI18n' para atender a regra de Fast Refresh